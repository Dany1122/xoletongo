{% extends 'base.html' %}
{% load static %}

{% block titulo %}{{ producto.nombre }} - {{ empresa.nombre }}{% endblock %}

{% block content %}

<!-- Banner -->
<div class="bradcam_area breadcam_bg_tienda" style="background-image: url('{% static "img/banner/banner.png" %}');">
    <div class="overlay" style="background-color: rgba(0, 0, 0, 0.4);"></div>
</div>

<!-- Breadcrumb -->
<div class="container" style="padding: 15px 0 10px 0;">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-transparent p-0 m-0" style="font-size: 14px;">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}" style="color: #000;">Inicio</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'productos' %}" style="color: #000;">Productos</a></li>
                    <li class="breadcrumb-item active" style="color: #000;">{{ producto.nombre }}</li>
                </ol>
            </nav>
        </div>
    </div>
</div>

<!-- Detalle del Producto -->
<section class="producto_detalle_area" style="padding: 20px 0 80px 0;">
    <div class="container">
        <div class="row">
            <!-- Imagen del producto -->
            <div class="col-lg-6 mb-4">
                <div class="producto-imagen-container bg-light rounded shadow-sm p-3">
                    {% if producto.imagen %}
                    <img src="{{ producto.imagen.url }}" class="img-fluid rounded" alt="{{ producto.nombre }}" style="width: 100%; height: auto; max-height: 500px; object-fit: contain;">
                    {% else %}
                    <div class="bg-secondary d-flex align-items-center justify-content-center rounded" style="height: 500px;">
                        <i class="fa fa-image fa-5x text-white"></i>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Información del producto -->
            <div class="col-lg-6">
                <div class="producto-info">
                    <h2 class="mb-3">{{ producto.nombre }}</h2>
                    
                    {% if producto.categoria %}
                    <p class="text-muted mb-3">
                        <i class="fa fa-tag"></i> Categoría: <strong>{{ producto.categoria.nombre }}</strong>
                    </p>
                    {% endif %}

                    <h3 class="text-primary mb-4">${{ producto.precio }}</h3>

                    <div class="mb-4">
                        <h5>Descripción</h5>
                        <p class="text-muted">{{ producto.descripcion|default:"Sin descripción disponible." }}</p>
                    </div>

                    <!-- Atributos personalizados -->
                    {% if producto.atributos_personalizados %}
                    <div class="mb-4">
                        <h5>Detalles</h5>
                        <ul class="list-unstyled">
                            {% for key, value in producto.atributos_personalizados.items %}
                            <li class="mb-2">
                                <strong>{{ key }}:</strong> {{ value }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <!-- Stock -->
                    <div class="mb-4">
                        {% if producto.stock > 0 %}
                        <span class="badge badge-success p-2">
                            <i class="fa fa-check-circle"></i> Disponible ({{ producto.stock }} en stock)
                        </span>
                        {% else %}
                        <span class="badge badge-danger p-2">
                            <i class="fa fa-times-circle"></i> Agotado
                        </span>
                        {% endif %}
                    </div>

                    <!-- Formulario de agregar al carrito -->
                    {% if producto.stock > 0 %}
                    <form method="POST" action="{% url 'agregar_al_carrito' producto.id %}" class="mb-4">
                        {% csrf_token %}
                        <div class="form-row align-items-center">
                            <div class="col-auto">
                                <label for="cantidad" class="mr-2">Cantidad:</label>
                            </div>
                            <div class="col-auto">
                                <input type="number" name="cantidad" id="cantidad" class="form-control" value="1" min="1" max="{{ producto.stock }}" style="width: 100px;">
                            </div>
                            <div class="col-auto">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fa fa-cart-plus"></i> Agregar al Carrito
                                </button>
                            </div>
                        </div>
                    </form>
                    {% else %}
                    <button class="btn btn-secondary btn-lg" disabled>
                        Producto Agotado
                    </button>
                    {% endif %}

                    <!-- SKU -->
                    <p class="text-muted small mt-3">SKU: {{ producto.sku }}</p>
                </div>
            </div>
        </div>

        <!-- Productos relacionados -->
        {% if productos_relacionados %}
        <div class="row mt-5">
            <div class="col-12">
                <h4 class="mb-4">Productos Relacionados</h4>
            </div>
            {% for prod in productos_relacionados %}
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="card h-100 producto-card-small shadow-sm">
                    <a href="{% url 'producto_detalle' prod.id %}">
                        {% if prod.imagen %}
                        <img src="{{ prod.imagen.url }}" class="card-img-top" alt="{{ prod.nombre }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
                            <i class="fa fa-image fa-2x text-white"></i>
                        </div>
                        {% endif %}
                    </a>
                    <div class="card-body">
                        <h6 class="card-title">
                            <a href="{% url 'producto_detalle' prod.id %}" class="text-dark">{{ prod.nombre }}</a>
                        </h6>
                        <p class="text-primary font-weight-bold mb-2">${{ prod.precio }}</p>
                        <a href="{% url 'producto_detalle' prod.id %}" class="btn btn-sm btn-outline-primary btn-block">
                            Ver Detalle
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Sección de Reseñas -->
        <div class="row mt-5">
            <div class="col-12">
                {% include 'resenas_partial.html' with object=producto content_type=content_type tipo_objeto="producto" %}
            </div>
        </div>
    </div>
</section>

<style>
    .bradcam_area {
        position: relative;
        background-size: cover;
        background-position: center;
        padding: 120px 0 60px;
        text-align: center;
        color: white;
        min-height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }

    .bradcam_bg_tienda {
        background-image: url('{% static "img/banner/banner.png" %}');
    }

    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
        z-index: 1;
    }

    /* Breadcrumb separators */
    .breadcrumb-item + .breadcrumb-item::before {
        content: "/" !important;
        display: inline-block !important;
        padding-right: 0.5rem !important;
        padding-left: 0.5rem !important;
        color: #6c757d !important;
        opacity: 1 !important;
        visibility: visible !important;
        font-size: 14px !important;
        font-weight: normal !important;
    }
    
    ol.breadcrumb li.breadcrumb-item + li.breadcrumb-item::before {
        content: "/" !important;
        display: inline-block !important;
    }

    .bradcam_area h3,
    .bradcam_area p,
    .bradcam_area i,
    .bradcam_area .breadcrumb {
        position: relative;
        z-index: 2;
        color: white;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        color: white;
    }

    .breadcrumb-item.active {
        font-weight: 600;
    }

    .breadcrumb-item a {
        color: white;
        text-decoration: none;
    }

    .breadcrumb-item a:hover {
        color: var(--color-acento, #FFD700);
    }

    .producto-imagen-container {
        transition: box-shadow 0.3s ease;
    }

    .producto-imagen-container:hover {
        box-shadow: 0 10px 30px rgba(0,0,0,0.3) !important;
    }

    .producto-info h2 {
        font-weight: 700;
        color: #333;
    }

    .producto-card-small {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
        border-radius: 10px;
        overflow: hidden;
    }

    .producto-card-small:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.2) !important;
    }

    .producto-card-small .card-title a {
        text-decoration: none;
        font-weight: 600;
    }

    .producto-card-small .card-title a:hover {
        color: var(--color-acento, #FF9800) !important;
    }

    .btn-primary {
        background-color: var(--color-primario, #4CAF50);
        border-color: var(--color-primario, #4CAF50);
    }

    .btn-primary:hover {
        background-color: var(--color-acento, #FF9800);
        border-color: var(--color-acento, #FF9800);
    }
</style>

{% endblock %}

